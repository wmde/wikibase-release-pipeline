## Advanced configuration

On first launch, WBS Deploy will create files in the `deploy/config` directory. This is your instance configuration. **You own and control these files.** Be sure to include them in your backups.

### `config/LocalSettings.php`

This file is generated by the [MediaWiki installer script](https://www.mediawiki.org/wiki/Manual:Install.php) and supplemented by the Wikibase container's `entrypoint.sh` script on first launch. Once this file has been generated, you own and control it. You may _need_ to make changes to it for [MediaWiki major version updates](https://www.mediawiki.org/wiki/Manual:Upgrading#Adapt_your_LocalSettings.php).

If `config/LocalSettings.php` is missing, it triggers the Wikibase container to run the [MediaWiki installer script](https://www.mediawiki.org/wiki/Manual:Install.php). If you need to run the installer again, you can remove the `deploy/config/LocalSettings.php` file (but keep a backup just in case!) and restart your instance.

### `config/wikibase-php.ini`

This is Wikibase's `php.ini` override file, a good place for tuning PHP configuration values. It gets loaded by the Mediawiki Wikibase web server's PHP interpreter.

### `config/wdqs-frontend-config.json`

This configuration file allows you to control `wdqs-frontend`, the GUI for the query service.

### User-defined extensions

It is possible to add extensions to Wikibase Suite Deploy's MediaWiki. To learn how this works, consult the [README in `deploy/config/extensions`](./config/extensions/README.md).


### docker-compose.yml

To further customize your instance, you can also make changes to `docker-compose.yml`. To ease updating to newer versions of WBS Deploy, consider putting your customizations into a new file called, for example, `docker-compose.override.yml`. If you do this, you'll need to start using the following commands to restart your instance:

```sh
docker compose -f docker-compose.yml -f docker-compose.override.yml down
docker compose -f docker-compose.yml -f docker-compose.override.yml up
```

This way, your changes are kept separate from the original WBS Deploy code.

## Managing your data

Besides [your configuration](#advanced-configuration), it's your data that makes your instance unique. All instance data is stored in [Docker volumes](https://docs.docker.com/storage/volumes/).

- `wikibase-image-data`: MediaWiki image and media file uploads
- `mysql-data`: MediaWiki/Wikibase MariaDB raw database
- `wdqs-data`: Wikidata Query Service raw database
- `elasticsearch-data`: Elasticsearch raw database
- `quickstatements-data`: generated Quickstatements OAuth binding for this MediaWiki instance
- `traefik-letsencrypt-data`: Traefik SSL certificates generated by letsencrypt

### Back up your data

To back up your data, shut down the instance and dump the contents of all Docker volumes into `.tar.gz` files.

```sh
docker compose down

for v in \
    wbs-deploy_wikibase-image-data \
    wbs-deploy_mysql-data \
    wbs-deploy_wdqs-data \
    wbs-deploy_elasticsearch-data \
    wbs-deploy_quickstatements-data \
    wbs-deploy_traefik-letsencrypt-data \
    ; do
  docker run --rm --volume $v:/backup debian:12-slim tar cz backup > $v.tar.gz
done
```

### Restore from a backup

To restore the volume backups, ensure your instance has been shut down by running `docker compose down` and populate the Docker volumes with data from your `.tar.gz` files.

```sh
docker compose down

for v in \
    wbs-deploy_wikibase-image-data \
    wbs-deploy_mysql-data \
    wbs-deploy_wdqs-data \
    wbs-deploy_elasticsearch-data \
    wbs-deploy_quickstatements-data \
    wbs-deploy_traefik-letsencrypt-data \
    ; do
  docker volume rm $v 2> /dev/null
  docker volume create $v
  docker run -i --rm --volume $v:/backup debian:12-slim tar xz < $v.tar.gz
done
```